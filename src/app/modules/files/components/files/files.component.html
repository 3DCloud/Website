<h1>My Files</h1>

<div class="file-upload-zone">
  <label for="file-upload" [class.bg-primary]="hover">
    <span class="row">
      <span class="col-12 col-lg-10 offset-lg-1 offset-xl-2 col-xl-8">
        <span *ngIf="uploadStatus.uploading">
          <span [ngSwitch]="uploadStatus.step" class="mb-1">
            <ng-template ngSwitchCase="starting">Preparing&hellip;</ng-template>
            <ng-template ngSwitchCase="uploading">Uploading '{{uploadStatus.fileName}}'&hellip; {{uploadStatus.progress | number: '1.1-1' }}%</ng-template>
            <ng-template ngSwitchCase="processing">Processing&hellip;</ng-template>
          </span>
          <ngb-progressbar *ngIf="uploadStatus.step === 'uploading'" type="primary" [value]="uploadStatus.progress"></ngb-progressbar>
          <ngb-progressbar *ngIf="uploadStatus.step !== 'uploading'" type="primary" [value]="100" [animated]="true" [striped]="true"></ngb-progressbar>
        </span>

        <span *ngIf="uploadStatus.success">
          File '{{uploadStatus.fileName}}' uploaded successfully!
        </span>

        <span *ngIf="uploadStatus.error">
          Failed to upload: {{uploadStatus.error}}
        </span>

        <span *ngIf="!uploadStatus.uploading" class="mt-1">
          <fa-icon [icon]="icons.faUpload"></fa-icon>
          Drag and drop a G-code file here or click to browse&hellip;
        </span>
      </span>
    </span>

    <input #uploadFileInput id="file-upload" type="file" (change)="upload($event)" accept=".gcode"/>
  </label>
</div>

<div class="files-table mt-3">
  <app-spinner *ngIf="loading"></app-spinner>

  <table *ngIf="!loading && files.length" class="table">
    <thead>
      <tr>
        <th>Name</th>
        <th>Size</th>
        <th>Upload Time</th>
        <th>Estimated Duration</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let file of files">
        <td>{{file.filename ? file.filename : '&mdash;'}}</td>
        <td>{{bytesToReadable(file.byteSize)}}</td>
        <td><span [ngbTooltip]="file.createdAt | djsDateFormat: 'LLL'">{{file.createdAt | djsTimeAgo}}</span></td>
        <td>
          <span *ngIf="file.estimatedDuration">{{ file.estimatedDuration * 1000 | djsDuration: true }}</span>
          <span *ngIf="!file.estimatedDuration">&ndash;</span>
        </td>
        <td>
          <button type="button" class="btn btn-light" (click)="downloadFile(file.id)"><fa-icon [icon]="icons.faDownload"></fa-icon></button>
          <button type="button" class="ml-1 btn btn-primary" (click)="showSelectPrinterModal(file.id)">Print&hellip;</button>
          <button type="button" class="ml-1 btn btn-danger" (click)="deleteFile(file)" [disabled]="file.busy"><fa-icon [icon]="icons.faTrash"></fa-icon></button>
        </td>
      </tr>
    </tbody>
  </table>

  <div *ngIf="!files.length && !loading && !error" class="alert alert-info">
    No files found. Try uploading one by using the box above!
  </div>

  <div *ngIf="error" class="alert alert-danger">
    Failed to get files: {{error}}
  </div>
</div>
